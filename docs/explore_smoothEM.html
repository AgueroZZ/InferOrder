<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ziang Zhang" />

<meta name="date" content="2025-07-07" />

<title>Exploring smooth-EM algorithm with various priors</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Inferring latent ordering</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/AgueroZZ/InferOrder">source</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Exploring smooth-EM algorithm with various
priors</h1>
<h4 class="author">Ziang Zhang</h4>
<h4 class="date">2025-07-07</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2025-07-08
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 1
</p>
<p>
<strong>Knit directory:</strong> <code>InferOrder/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.1). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguncommittedchanges">
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> <strong>R Markdown file:</strong> uncommitted
changes </a>
</p>
</div>
<div id="strongRMarkdownfilestronguncommittedchanges"
class="panel-collapse collapse">
<div class="panel-body">
<p>The R Markdown file has unstaged changes. To know which version of
the R Markdown file created these results, you’ll want to first commit
it to the Git repo. If you’re still working on the analysis, you can
ignore this warning. When you’re finished, you can run
<code>wflow_publish</code> to commit the R Markdown file and build the
HTML.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20250707code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20250707)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20250707code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20250707)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomAgueroZZInferOrdertreedbcdf9aa908266d3ffc0296ed082786e7a561b58targetblankdbcdf9aa">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/AgueroZZ/InferOrder/tree/dbcdf9aa908266d3ffc0296ed082786e7a561b58" target="_blank">dbcdf9a</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomAgueroZZInferOrdertreedbcdf9aa908266d3ffc0296ed082786e7a561b58targetblankdbcdf9aa"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/AgueroZZ/InferOrder/tree/dbcdf9aa908266d3ffc0296ed082786e7a561b58" target="_blank">dbcdf9a</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .DS_Store
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    analysis/.DS_Store

Untracked files:
    Untracked:  all_celltypes_umap.png
    Untracked:  code/general_EM_obs.R

Unstaged changes:
    Modified:   analysis/explore_smoothEM.rmd
    Modified:   code/general_EM.R
    Modified:   code/linear_EM.R

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">
<p>
These are the previous versions of the repository in which changes were
made to the R Markdown (<code>analysis/explore_smoothEM.rmd</code>) and
HTML (<code>docs/explore_smoothEM.html</code>) files. If you’ve
configured a remote Git repository (see <code>?wflow_git_remote</code>),
click on the hyperlinks in the table below to view the files as they
were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/AgueroZZ/InferOrder/2322978203fba9286dc47b45efd01219fdbd924f/docs/explore_smoothEM.html" target="_blank">2322978</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/AgueroZZ/InferOrder/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/explore_smoothEM.html" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/ccaa3200a3b29f4114d9e1fa983f003854cbb9c0/analysis/explore_smoothEM.rmd" target="_blank">ccaa320</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-07
</td>
<td>
workflowr::wflow_publish("analysis/explore_smoothEM.rmd")
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this study, we consider a mixture model with <span
class="math inline">\(K\)</span> components, specified as follows: <span
class="math display">\[\begin{equation}
\label{eq:smooth-EM}
\begin{aligned}
\boldsymbol{X}_i \mid z_i = k &amp;\sim \mathcal{N}(\boldsymbol{\mu}_k,
\boldsymbol{\Sigma}_k) \quad i\in [n], \\
\boldsymbol{U} = (\boldsymbol{\mu}_1, \ldots, \boldsymbol{\mu}_K)
&amp;\sim \mathcal{N}(\boldsymbol{0}, \mathbf{Q}^{-1}),
\end{aligned}
\end{equation}\]</span> where <span
class="math inline">\(\boldsymbol{X}_i \in \mathbb{R}^d\)</span> denotes
the observed data, <span class="math inline">\(z_i \in [K]\)</span> is a
latent indicator assigning observation <span
class="math inline">\(i\)</span> to component <span
class="math inline">\(k\)</span>, <span
class="math inline">\(\boldsymbol{\mu}_k \in \mathbb{R}^d\)</span> is
the mean vector of component <span class="math inline">\(k\)</span>, and
<span class="math inline">\(\boldsymbol{\Sigma}_k \in
\mathbb{R}^{d\times d}\)</span> is its covariance matrix.</p>
<p>The prior distribution over the stacked mean vectors <span
class="math inline">\(\boldsymbol{U}\)</span> is multivariate normal
with mean zero and precision matrix <span
class="math inline">\(\mathbf{Q}\)</span>. This prior can encode
smoothness or structural assumptions about how the component means
evolve or are ordered (e.g., spatial or temporal constraints across
<span class="math inline">\(k=1,\ldots,K\)</span>).</p>
<p>Rather than using the standard EM algorithm, we employ a
<strong>smooth-EM</strong> approach that incorporates this structured
prior over component means. In this framework:</p>
<ul>
<li><p><strong>E-step (standard):</strong> <span class="math display">\[
\gamma_{ik}^{(t)} = \frac{\pi_k^{(t)} \, \mathcal{N}(\boldsymbol{X}_i
\mid \boldsymbol{\mu}_k^{(t)},
\boldsymbol{\Sigma}_k^{(t)})}{\sum_{j=1}^K \pi_j^{(t)} \,
\mathcal{N}(\boldsymbol{X}_i \mid \boldsymbol{\mu}_j^{(t)},
\boldsymbol{\Sigma}_j^{(t)})}.
\]</span></p></li>
<li><p><strong>M-step (incorporating prior):</strong> <span
class="math display">\[
\begin{aligned}
\{\pi^{(t+1)}, \mathbf{U}^{(t+1)}, \boldsymbol{\Sigma}^{(t+1)}\}
&amp;= \arg\max \, \mathbb{E}_{\gamma^{(t)}}\Big[\log p(\boldsymbol{X},
\mathbf{U}, \mathbf{Z} \mid \pi, \boldsymbol{\Sigma})\Big] \\
&amp;= \arg\max \, \mathbb{E}_{\gamma^{(t)}}\Big[\log p(\boldsymbol{X},
\mathbf{Z} \mid \pi, \mathbf{U}, \boldsymbol{\Sigma}) + \log
p(\mathbf{U})\Big] \\
&amp;= \arg\max \, \bigg\{\mathbb{E}_{\gamma^{(t)}}\Big[\log
p(\boldsymbol{X}, \mathbf{Z} \mid \pi, \mathbf{U},
\boldsymbol{\Sigma})\Big] - \frac{1}{2} \mathbf{U}^\top \mathbf{Q}
\mathbf{U}\bigg\} \\
&amp;= \arg\max \, \left\{ -\frac{1}{2} \sum_{i,k} \gamma_{ik}^{(t)}
\|\boldsymbol{X}_i - \boldsymbol{\mu}_k\|^2_{\boldsymbol{\Sigma}_k^{-1}}
- \frac{1}{2} \mathbf{U}^\top \mathbf{Q} \mathbf{U}\right\}.
\end{aligned}
\]</span></p></li>
</ul>
<p>Unlike the standard EM algorithm, which maximizes the likelihood
independently over component means, the smooth-EM algorithm performs MAP
estimation that considers the prior of <span
class="math inline">\(\boldsymbol{U}\)</span>, encouraging ordered or
smooth transitions across components indexed by <span
class="math inline">\(k\)</span>.</p>
<p>We will now explore how this smooth-EM algorithm behaves under
different prior specifications for <span
class="math inline">\(\mathbf{Q}\)</span>.</p>
</div>
<div id="simulate-mixture-in-2d" class="section level2">
<h2>Simulate mixture in 2D</h2>
<p>Here, we will simulate a mixture of Gaussians in 2D, for <span
class="math inline">\(n = 500\)</span> observations and <span
class="math inline">\(K = 5\)</span> components.</p>
<pre class="r"><code>source(&quot;./code/simulate.R&quot;)
library(MASS)
library(mvtnorm)</code></pre>
<pre><code>Warning: package &#39;mvtnorm&#39; was built under R version 4.3.3</code></pre>
<pre class="r"><code>palette_colors &lt;- rainbow(5)
alpha_colors &lt;- sapply(palette_colors, function(clr) adjustcolor(clr, alpha.f=0.3))
sim &lt;- simulate_mixture(n=500, K = 5, d=2, seed=123, proj_mat = matrix(c(1,-0.6,-0.6,1), nrow = 2, byrow = T))</code></pre>
<pre class="r"><code>plot(sim$X, col = alpha_colors[sim$z],
     pch = 19, cex = 0.5, 
     xlab = &quot;X1&quot;, ylab = &quot;X2&quot;,
     main = &quot;Simulated mixture of Gaussians in 2D&quot;)</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-2-1">
Past versions of unnamed-chunk-2-1.png
</button>
</p>
<div id="fig-unnamed-chunk-2-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-2-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Now, let’s assume we don’t know there are five components, and we
will fit a mixture model with <span class="math inline">\(K =
20\)</span> components to this data. For simplicity, let’s assume <span
class="math inline">\(\mathbf{\Sigma}_k = \sigma^2 \mathbf{I}\)</span>
for all <span class="math inline">\(k\)</span>, where <span
class="math inline">\(\sigma^2\)</span> is a constant variance across
components.</p>
<div id="fitting-regular-em" class="section level3">
<h3>Fitting regular EM</h3>
<p>First, we fit the standard EM algorithm to this mixture model without
any prior on the means.</p>
<pre class="r"><code>library(mclust)</code></pre>
<pre><code>Package &#39;mclust&#39; version 6.1.1
Type &#39;citation(&quot;mclust&quot;)&#39; for citing this R package in publications.</code></pre>
<pre><code>
Attaching package: &#39;mclust&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:mvtnorm&#39;:

    dmvnorm</code></pre>
<pre class="r"><code>fit_mclust &lt;- Mclust(sim$X, G=20)</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z],
     xlab=&quot;X1&quot;, ylab=&quot;X2&quot;,
     cex=0.5, pch=19, main=&quot;mclust&quot;)
mclust_means &lt;- t(fit_mclust$parameters$mean)
points(mclust_means, pch=3, cex=2, lwd=2, col=&quot;red&quot;)</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-4-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-4-1">
Past versions of unnamed-chunk-4-1.png
</button>
</p>
<div id="fig-unnamed-chunk-4-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-4-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The inferred means are shown in red. We can see that the means are
well aligned with the true component means, but we don’t have a natural
ordering of the means.</p>
</div>
<div id="fitting-smooth-em-with-a-linear-prior" class="section level3">
<h3>Fitting smooth-EM with a linear prior</h3>
<p>We consider the simplest case for the prior on the component means
<span class="math inline">\(\mathbf{U}\)</span>, where <span
class="math inline">\(\mathbf{Q}\)</span> corresponds to a linear trend
prior. Specifically, we assume that <span class="math display">\[
\boldsymbol{\mu}_k = l_k \boldsymbol{\beta},
\]</span> for some shared slope vector <span
class="math inline">\(\boldsymbol{\beta} \in \mathbb{R}^d\)</span>, with
<span class="math inline">\(\{l_k\}\)</span> being equally spaced values
increasing from <span class="math inline">\(-1\)</span> to <span
class="math inline">\(1\)</span>.</p>
<pre class="r"><code>source(&quot;./code/linear_EM.R&quot;)
source(&quot;./code/general_EM.R&quot;)</code></pre>
<pre><code>Warning: package &#39;matrixStats&#39; was built under R version 4.3.3</code></pre>
<pre class="r"><code>result_linear &lt;- EM_algorithm_linear(
  data = sim$X,
  K = 20,
  betaprec = 0.001,
  seed = 1,
  max_iter = 100,
  verbose = TRUE
)</code></pre>
<pre><code>Iteration   1: objective = -1794.785290
Iteration   2: objective = -1676.287607
Iteration   3: objective = -1594.534882
Iteration   4: objective = -1547.815205
Iteration   5: objective = -1520.284196
Iteration   6: objective = -1505.535764
Iteration   7: objective = -1499.831666
Iteration   8: objective = -1492.486764
Iteration   9: objective = -1467.281786
Iteration  10: objective = -1423.922556
Iteration  11: objective = -1392.955481
Iteration  12: objective = -1374.137729
Iteration  13: objective = -1362.239220
Iteration  14: objective = -1354.345894
Iteration  15: objective = -1348.967906
Iteration  16: objective = -1345.309281
Iteration  17: objective = -1342.819447
Iteration  18: objective = -1341.063884
Iteration  19: objective = -1339.599799
Iteration  20: objective = -1338.073416
Iteration  21: objective = -1336.802795
Iteration  22: objective = -1335.823345
Iteration  23: objective = -1334.509331
Iteration  24: objective = -1332.522383
Iteration  25: objective = -1329.292722
Iteration  26: objective = -1323.409944
Iteration  27: objective = -1315.566099
Iteration  28: objective = -1303.067541
Iteration  29: objective = -1285.883153
Iteration  30: objective = -1266.520610
Iteration  31: objective = -1242.896699
Iteration  32: objective = -1218.750880
Iteration  33: objective = -1195.032745
Iteration  34: objective = -1174.064575
Iteration  35: objective = -1159.252399
Iteration  36: objective = -1146.819267
Iteration  37: objective = -1139.761038
Iteration  38: objective = -1134.543798
Iteration  39: objective = -1132.456566
Iteration  40: objective = -1130.845108
Iteration  41: objective = -1129.007986
Iteration  42: objective = -1126.329907
Iteration  43: objective = -1123.545288
Iteration  44: objective = -1121.857487
Iteration  45: objective = -1120.831180
Iteration  46: objective = -1120.219780
Iteration  47: objective = -1119.844230
Iteration  48: objective = -1119.534582
Iteration  49: objective = -1119.234419
Iteration  50: objective = -1118.912224
Iteration  51: objective = -1118.575739
Iteration  52: objective = -1118.300720
Iteration  53: objective = -1118.084234
Iteration  54: objective = -1117.889961
Iteration  55: objective = -1117.712607
Iteration  56: objective = -1117.549722
Iteration  57: objective = -1117.386903
Iteration  58: objective = -1117.178771
Iteration  59: objective = -1116.878916
Iteration  60: objective = -1116.526803
Iteration  61: objective = -1116.195578
Iteration  62: objective = -1115.909015
Iteration  63: objective = -1115.662271
Iteration  64: objective = -1115.447616
Iteration  65: objective = -1115.259644
Iteration  66: objective = -1115.094964
Iteration  67: objective = -1114.951226
Iteration  68: objective = -1114.826497
Iteration  69: objective = -1114.719243
Iteration  70: objective = -1114.629180
Iteration  71: objective = -1114.559518
Iteration  72: objective = -1114.511041
Iteration  73: objective = -1114.314872
Iteration  74: objective = -1113.482912
Iteration  75: objective = -1113.790817
Converged at iteration 75 with objective -1113.790817</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     pch=19, main=&quot;EM Fitted Means with linear Prior&quot;)
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, result_linear$params$mu)
# Draw arrows showing sequence
for (k in 1:(nrow(mu_matrix)-1)) {
  arrows(mu_matrix[k,1], mu_matrix[k,2],
         mu_matrix[k+1,1], mu_matrix[k+1,2],
         col=&quot;orange&quot;, lwd=4, length=0.1)
}</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-6-1">
Past versions of unnamed-chunk-6-1.png
</button>
</p>
<div id="fig-unnamed-chunk-6-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-6-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here the fitted means are shown as orange arrows, with direction
indicating the order of the components.</p>
<p>Note that the fitted slope <span
class="math inline">\(\boldsymbol{\beta}\)</span> is very close to the
first principal component of the data.</p>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     xlab=&quot;X1&quot;, ylab=&quot;X2&quot;,
     pch=19, main=&quot;EM Fitted Means with Linear Prior&quot;)
     
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, result_linear$params$mu)

# Draw arrows showing sequence of cluster means
for (k in 1:(nrow(mu_matrix)-1)) {
  if (sqrt(sum((mu_matrix[k+1,] - mu_matrix[k,])^2)) &gt; 1e-6) {
    arrows(mu_matrix[k,1], mu_matrix[k,2],
           mu_matrix[k+1,1], mu_matrix[k+1,2],
           col=&quot;orange&quot;, lwd=4, length=0.1)
  }
}

# ====== Fit PCA ======
pca_fit &lt;- prcomp(sim$X, center=TRUE, scale.=FALSE)
pcs &lt;- pca_fit$rotation  # columns are PC directions
X_center &lt;- colMeans(sim$X)

# Set radius for arrows
radius &lt;- 1

# ====== Draw PC arrows ======
arrows(
  X_center[1], X_center[2],
  X_center[1] + radius * pcs[1,1],
  X_center[2] + radius * pcs[2,1],
  col=&quot;red&quot;, lwd=4, length=0.1
)
text(
  X_center[1] + radius * pcs[1,1],
  X_center[2] + radius * pcs[2,1],
  labels=&quot;PC1&quot;, pos=4, col=&quot;red&quot;
)</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-7-1">
Past versions of unnamed-chunk-7-1.png
</button>
</p>
<div id="fig-unnamed-chunk-7-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-7-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="fitting-smooth-em-with-a-var1-prior" class="section level3">
<h3>Fitting smooth-EM with a VAR(1) prior</h3>
<p>Next, we consider a first-order vector autoregressive (VAR(1)) prior
on the component means. Under this prior, each component mean <span
class="math inline">\(\boldsymbol{\mu}_k\)</span> depends linearly on
its immediate predecessor <span
class="math inline">\(\boldsymbol{\mu}_{k-1}\)</span>, with Gaussian
noise: <span class="math display">\[
\begin{aligned}
\boldsymbol{\mu}_k &amp;= \mathbf{A} \boldsymbol{\mu}_{k-1} +
\boldsymbol{\epsilon}_k, \\
\boldsymbol{\epsilon}_k &amp;\sim \mathcal{N}(\mathbf{0},
\mathbf{Q}_\epsilon^{-1}),
\end{aligned}
\]</span> where <span class="math inline">\(\mathbf{A}\)</span> is the
transition matrix encoding the dependence of the current mean on the
previous mean, and <span
class="math inline">\(\mathbf{Q}_\epsilon\)</span> is the precision
matrix of the noise term.</p>
<p>Let’s for now assume the transition matrix <span
class="math inline">\(\mathbf{A}\)</span> and the noise precision matrix
<span class="math inline">\(\mathbf{Q}_\epsilon\)</span> are given
by:</p>
<p><span class="math display">\[
\mathbf{A} = 0.8 \, \mathbf{I}_2
\]</span> <span class="math display">\[
\mathbf{Q}_\epsilon = 0.1 \, \mathbf{I}_2
\]</span></p>
<p>where <span class="math inline">\(\mathbf{I}_2\)</span> is the
2-dimensional identity matrix.</p>
<pre class="r"><code>source(&quot;./code/prior_precision.R&quot;)
Q_prior_VAR1 &lt;- make_VAR1_precision(K=20, d=2, A = diag(2) * 0.8, Q = diag(2) * 0.1)
set.seed(1)
init_params &lt;- make_default_init(sim$X, K=20)
result_VAR1 &lt;- EM_algorithm(
  data = sim$X,
  Q_prior = Q_prior_VAR1,
  init_params = init_params,
  max_iter = 100,
  modelName = &quot;EII&quot;,
  tol = 1e-5,
  verbose = TRUE
)</code></pre>
<pre><code>Iteration 1: objective = -1958.4957
Iteration 2: objective = -1716.3758
Iteration 3: objective = -1621.1090
Iteration 4: objective = -1483.2038
Iteration 5: objective = -1482.9465
Iteration 6: objective = -1482.7929
Iteration 7: objective = -1482.5235
Iteration 8: objective = -1482.0087
Iteration 9: objective = -1480.9540
Iteration 10: objective = -1478.6996
Iteration 11: objective = -1473.9652
Iteration 12: objective = -1464.8801
Iteration 13: objective = -1449.2401
Iteration 14: objective = -1424.5433
Iteration 15: objective = -1390.0631
Iteration 16: objective = -1350.8749
Iteration 17: objective = -1316.2225
Iteration 18: objective = -1294.2820
Iteration 19: objective = -1286.2432
Iteration 20: objective = -1285.0849
Converged at iteration 21 with objective -1285.3027</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     xlab=&quot;X1&quot;, ylab=&quot;X2&quot;,
     pch=19, main=&quot;EM Fitted Means with VAR(1) Prior&quot;)
     
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, result_VAR1$params$mu)

# Draw arrows showing sequence of cluster means
for (k in 1:(nrow(mu_matrix)-1)) {
  if (sqrt(sum((mu_matrix[k+1,] - mu_matrix[k,])^2)) &gt; 1e-6) {
    arrows(mu_matrix[k,1], mu_matrix[k,2],
           mu_matrix[k+1,1], mu_matrix[k+1,2],
           col=&quot;orange&quot;, lwd=4, length=0.1)
  }
}</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-9-1">
Past versions of unnamed-chunk-9-1.png
</button>
</p>
<div id="fig-unnamed-chunk-9-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-9-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="fitting-smooth-em-with-a-rw1-prior" class="section level3">
<h3>Fitting smooth-EM with a RW1 prior</h3>
<p>Next, we consider a first-order random walk (RW1) prior on the
component means, formulated using the difference operator. Under this
prior, successive differences of the means are modeled as independent
Gaussian noise:</p>
<p><span class="math display">\[
\Delta \boldsymbol{\mu}_k = \boldsymbol{\mu}_k - \boldsymbol{\mu}_{k-1}
\sim \mathcal{N}\big(\mathbf{0}, \lambda^{-1} \mathbf{I}_d\big),
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is a scalar
precision parameter that controls the smoothness of the mean sequence.
Larger values of <span class="math inline">\(\lambda\)</span> enforce
stronger smoothness by penalizing large differences between successive
component means.</p>
<pre class="r"><code>Q_prior_RW1 &lt;- make_random_walk_precision(K=20, d=2, lambda = 5)
result_RW1 &lt;- EM_algorithm(
  data = sim$X,
  Q_prior = Q_prior_RW1,
  init_params = init_params,
  max_iter = 100,
  modelName = &quot;EII&quot;,
  tol = 1e-5,
  verbose = TRUE
)</code></pre>
<pre><code>Iteration 1: objective = -1669.1600
Iteration 2: objective = -1447.0245
Iteration 3: objective = -1430.4711
Iteration 4: objective = -1417.7644
Iteration 5: objective = -1352.0973
Iteration 6: objective = -1320.7124
Iteration 7: objective = -1320.7116
Iteration 8: objective = -1320.7105
Iteration 9: objective = -1320.7081
Iteration 10: objective = -1320.7029
Iteration 11: objective = -1320.6914
Iteration 12: objective = -1320.6650
Iteration 13: objective = -1320.5996
Iteration 14: objective = -1320.4142
Iteration 15: objective = -1319.7833
Iteration 16: objective = -1317.4450
Iteration 17: objective = -1309.8554
Iteration 18: objective = -1289.4234
Iteration 19: objective = -1244.3649
Iteration 20: objective = -1170.6025
Iteration 21: objective = -1110.6832
Iteration 22: objective = -1097.4406
Iteration 23: objective = -1096.1111
Iteration 24: objective = -1095.8917
Iteration 25: objective = -1095.8366
Iteration 26: objective = -1095.8194
Iteration 27: objective = -1095.8132
Iteration 28: objective = -1095.8107
Iteration 29: objective = -1095.8094
Iteration 30: objective = -1095.8084
Iteration 31: objective = -1095.8075
Iteration 32: objective = -1095.8067
Iteration 33: objective = -1095.8057
Iteration 34: objective = -1095.8046
Iteration 35: objective = -1095.8034
Iteration 36: objective = -1095.8021
Iteration 37: objective = -1095.8006
Iteration 38: objective = -1095.7989
Iteration 39: objective = -1095.7969
Iteration 40: objective = -1095.7947
Iteration 41: objective = -1095.7922
Iteration 42: objective = -1095.7893
Iteration 43: objective = -1095.7860
Iteration 44: objective = -1095.7822
Iteration 45: objective = -1095.7777
Iteration 46: objective = -1095.7726
Iteration 47: objective = -1095.7666
Iteration 48: objective = -1095.7596
Iteration 49: objective = -1095.7514
Iteration 50: objective = -1095.7417
Iteration 51: objective = -1095.7302
Iteration 52: objective = -1095.7166
Iteration 53: objective = -1095.7003
Iteration 54: objective = -1095.6807
Iteration 55: objective = -1095.6572
Iteration 56: objective = -1095.6285
Iteration 57: objective = -1095.5935
Iteration 58: objective = -1095.5503
Iteration 59: objective = -1095.4966
Iteration 60: objective = -1095.4291
Iteration 61: objective = -1095.3434
Iteration 62: objective = -1095.2334
Iteration 63: objective = -1095.0904
Iteration 64: objective = -1094.9024
Iteration 65: objective = -1094.6524
Iteration 66: objective = -1094.3169
Iteration 67: objective = -1093.8643
Iteration 68: objective = -1093.2545
Iteration 69: objective = -1092.4416
Iteration 70: objective = -1091.3828
Iteration 71: objective = -1090.0571
Iteration 72: objective = -1088.4902
Iteration 73: objective = -1086.7685
Iteration 74: objective = -1085.0190
Iteration 75: objective = -1083.3649
Iteration 76: objective = -1081.8967
Iteration 77: objective = -1080.6658
Iteration 78: objective = -1079.6840
Iteration 79: objective = -1078.9293
Iteration 80: objective = -1078.3626
Iteration 81: objective = -1077.9450
Iteration 82: objective = -1077.6462
Iteration 83: objective = -1077.4426
Iteration 84: objective = -1077.3103
Iteration 85: objective = -1077.2143
Iteration 86: objective = -1077.0918
Iteration 87: objective = -1076.8202
Iteration 88: objective = -1076.1348
Iteration 89: objective = -1074.1889
Iteration 90: objective = -1067.4701
Iteration 91: objective = -1053.8526
Iteration 92: objective = -1051.5103
Iteration 93: objective = -1051.3568
Iteration 94: objective = -1051.2443
Iteration 95: objective = -1051.1521
Iteration 96: objective = -1051.0744
Iteration 97: objective = -1051.0085
Iteration 98: objective = -1050.9522
Iteration 99: objective = -1050.9042
Iteration 100: objective = -1050.8632</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     xlab=&quot;X1&quot;, ylab=&quot;X2&quot;,
     pch=19, main=&quot;EM Fitted Means with RW(1) Prior&quot;)
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, result_RW1$params$mu)
# Draw arrows showing sequence of cluster means
for (k in 1:(nrow(mu_matrix)-1)) {
  if (sqrt(sum((mu_matrix[k+1,] - mu_matrix[k,])^2)) &gt; 1e-6) {
    arrows(mu_matrix[k,1], mu_matrix[k,2],
           mu_matrix[k+1,1], mu_matrix[k+1,2],
           col=&quot;orange&quot;, lwd=4, length=0.1)
  }
}</code></pre>
<pre><code>Warning in arrows(mu_matrix[k, 1], mu_matrix[k, 2], mu_matrix[k + 1, 1], :
zero-length arrow is of indeterminate angle and so skipped
Warning in arrows(mu_matrix[k, 1], mu_matrix[k, 2], mu_matrix[k + 1, 1], :
zero-length arrow is of indeterminate angle and so skipped
Warning in arrows(mu_matrix[k, 1], mu_matrix[k, 2], mu_matrix[k + 1, 1], :
zero-length arrow is of indeterminate angle and so skipped</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-11-1">
Past versions of unnamed-chunk-11-1.png
</button>
</p>
<div id="fig-unnamed-chunk-11-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-11-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The result of RW1 looks similar to that of VAR(1), which is not
surprising since the RW1 prior is a special case of the VAR(1) prior
with <span class="math inline">\(\mathbf{A} = \mathbf{I}\)</span>.</p>
<p>Note that RW1 is a partially improper prior, as the overall level of
the means is not penalized. In other words, the prior is invariant to
addition of any constant vector to all component means.</p>
</div>
<div id="fitting-smooth-em-with-a-rw2-prior" class="section level3">
<h3>Fitting smooth-EM with a RW2 prior</h3>
<p>Next, we consider a second-order random walk (RW2) prior on the
component means, which penalizes the second differences of the
means:</p>
<p><span class="math display">\[
\Delta^2 \boldsymbol{\mu}_k = \boldsymbol{\mu}_k -
2\boldsymbol{\mu}_{k-1} + \boldsymbol{\mu}_{k-2} \sim
\mathcal{N}\big(\mathbf{0}, \lambda^{-1} \mathbf{I}_d\big),
\]</span></p>
<p>where <span class="math inline">\(\Delta^2
\boldsymbol{\mu}_k\)</span> denotes the second-order difference
operator. The scalar precision parameter <span
class="math inline">\(\lambda\)</span> controls the smoothness of the
sequence, with larger values enforcing stronger penalization of
curvature.</p>
<pre class="r"><code>Q_prior_rw2 &lt;- make_random_walk_precision(K = 20, d = 2, q=2, lambda=400)
result_rw2 &lt;- EM_algorithm(
  data = sim$X,
  Q_prior = Q_prior_rw2,
  init_params = init_params,
  max_iter = 100,
  modelName = &quot;EII&quot;,
  tol = 1e-5,
  verbose = TRUE
)</code></pre>
<pre><code>Iteration 1: objective = -2717.3131
Iteration 2: objective = -2040.4867
Iteration 3: objective = -1712.1471
Iteration 4: objective = -1626.4376
Iteration 5: objective = -1384.5483
Iteration 6: objective = -1220.9010
Iteration 7: objective = -1198.9225
Iteration 8: objective = -1195.9110
Iteration 9: objective = -1195.2222
Iteration 10: objective = -1194.4981
Iteration 11: objective = -1193.2618
Iteration 12: objective = -1190.6613
Iteration 13: objective = -1184.5477
Iteration 14: objective = -1169.4566
Iteration 15: objective = -1134.6713
Iteration 16: objective = -1076.3360
Iteration 17: objective = -1032.1404
Iteration 18: objective = -1022.9190
Iteration 19: objective = -1022.2435
Iteration 20: objective = -1022.2303
Iteration 21: objective = -1022.1385
Iteration 22: objective = -1021.9050
Iteration 23: objective = -1021.4831
Iteration 24: objective = -1020.7971
Iteration 25: objective = -1019.7545
Iteration 26: objective = -1018.2650
Iteration 27: objective = -1016.2637
Iteration 28: objective = -1013.7339
Iteration 29: objective = -1010.7330
Iteration 30: objective = -1007.4247
Iteration 31: objective = -1004.0931
Iteration 32: objective = -1001.0844
Iteration 33: objective = -998.6681
Iteration 34: objective = -996.9198
Iteration 35: objective = -995.7364
Iteration 36: objective = -994.9474
Iteration 37: objective = -994.4062
Iteration 38: objective = -994.0169
Iteration 39: objective = -993.7237
Iteration 40: objective = -993.4947
Iteration 41: objective = -993.3106
Iteration 42: objective = -993.1591
Iteration 43: objective = -993.0317
Iteration 44: objective = -992.9223
Iteration 45: objective = -992.8264
Iteration 46: objective = -992.7407
Iteration 47: objective = -992.6623
Iteration 48: objective = -992.5895
Iteration 49: objective = -992.5204
Iteration 50: objective = -992.4537
Iteration 51: objective = -992.3883
Iteration 52: objective = -992.3234
Iteration 53: objective = -992.2580
Iteration 54: objective = -992.1914
Iteration 55: objective = -992.1230
Iteration 56: objective = -992.0521
Iteration 57: objective = -991.9783
Iteration 58: objective = -991.9011
Iteration 59: objective = -991.8198
Iteration 60: objective = -991.7342
Iteration 61: objective = -991.6437
Iteration 62: objective = -991.5480
Iteration 63: objective = -991.4468
Iteration 64: objective = -991.3396
Iteration 65: objective = -991.2263
Iteration 66: objective = -991.1064
Iteration 67: objective = -990.9799
Iteration 68: objective = -990.8465
Iteration 69: objective = -990.7060
Iteration 70: objective = -990.5584
Iteration 71: objective = -990.4036
Iteration 72: objective = -990.2415
Iteration 73: objective = -990.0722
Iteration 74: objective = -989.8957
Iteration 75: objective = -989.7121
Iteration 76: objective = -989.5215
Iteration 77: objective = -989.3240
Iteration 78: objective = -989.1198
Iteration 79: objective = -988.9091
Iteration 80: objective = -988.6922
Iteration 81: objective = -988.4692
Iteration 82: objective = -988.2404
Iteration 83: objective = -988.0061
Iteration 84: objective = -987.7666
Iteration 85: objective = -987.5223
Iteration 86: objective = -987.2734
Iteration 87: objective = -987.0204
Iteration 88: objective = -986.7636
Iteration 89: objective = -986.5036
Iteration 90: objective = -986.2407
Iteration 91: objective = -985.9754
Iteration 92: objective = -985.7084
Iteration 93: objective = -985.4401
Iteration 94: objective = -985.1712
Iteration 95: objective = -984.9024
Iteration 96: objective = -984.6342
Iteration 97: objective = -984.3674
Iteration 98: objective = -984.1027
Iteration 99: objective = -983.8407
Iteration 100: objective = -983.5823</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     pch=19, main=&quot;EM Fitted Means with RW2 Prior&quot;)
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, result_rw2$params$mu)
# Draw arrows showing sequence
for (k in 1:(nrow(mu_matrix)-1)) {
  arrows(mu_matrix[k,1], mu_matrix[k,2],
         mu_matrix[k+1,1], mu_matrix[k+1,2],
         col=&quot;orange&quot;, lwd=4, length=0.1)
}</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-13-1">
Past versions of unnamed-chunk-13-1.png
</button>
</p>
<div id="fig-unnamed-chunk-13-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-13-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Similar to the RW1 prior, the RW2 prior is also a partially improper
prior, as it is invariant to addition of a constant vector as well as a
linear trend (in terms of <span class="math inline">\(k\)</span>) to all
component means. As <span class="math inline">\(\lambda\)</span>
increases, the fitted means become closer to a linear trend.</p>
<pre class="r"><code>Q_prior_rw2_strong &lt;- make_random_walk_precision(K = 20, d = 2, q=2, lambda=4000)
Q_prior_rw2_strong &lt;- EM_algorithm(
  data = sim$X,
  Q_prior = Q_prior_rw2_strong,
  init_params = init_params,
  max_iter = 100,
  modelName = &quot;EII&quot;,
  tol = 1e-5,
  verbose = TRUE
)</code></pre>
<pre><code>Iteration 1: objective = -2543.3091
Iteration 2: objective = -1875.5104
Iteration 3: objective = -1225.2726
Iteration 4: objective = -1180.2106
Iteration 5: objective = -1177.4332
Iteration 6: objective = -1171.3993
Iteration 7: objective = -1159.9830
Iteration 8: objective = -1143.1198
Iteration 9: objective = -1126.1589
Iteration 10: objective = -1114.7535
Iteration 11: objective = -1106.9885
Iteration 12: objective = -1099.3001
Iteration 13: objective = -1090.3622
Iteration 14: objective = -1080.6620
Iteration 15: objective = -1072.0990
Iteration 16: objective = -1066.5441
Iteration 17: objective = -1063.9732
Iteration 18: objective = -1063.0584
Iteration 19: objective = -1062.7694
Iteration 20: objective = -1062.6747
Iteration 21: objective = -1062.6364
Iteration 22: objective = -1062.6116
Iteration 23: objective = -1062.5833
Iteration 24: objective = -1062.5382
Iteration 25: objective = -1062.4584
Iteration 26: objective = -1062.3137
Iteration 27: objective = -1062.0516
Iteration 28: objective = -1061.5820
Iteration 29: objective = -1060.7606
Iteration 30: objective = -1059.3833
Iteration 31: objective = -1057.2288
Iteration 32: objective = -1054.2017
Iteration 33: objective = -1050.5410
Iteration 34: objective = -1046.8627
Iteration 35: objective = -1043.8279
Iteration 36: objective = -1041.7294
Iteration 37: objective = -1040.4537
Iteration 38: objective = -1039.7286
Iteration 39: objective = -1039.3187
Iteration 40: objective = -1039.0764
Iteration 41: objective = -1038.9221
Iteration 42: objective = -1038.8162
Iteration 43: objective = -1038.7395
Iteration 44: objective = -1038.6818
Iteration 45: objective = -1038.6378
Iteration 46: objective = -1038.6039
Iteration 47: objective = -1038.5779
Iteration 48: objective = -1038.5578
Iteration 49: objective = -1038.5424
Iteration 50: objective = -1038.5307
Iteration 51: objective = -1038.5217
Iteration 52: objective = -1038.5149
Iteration 53: objective = -1038.5097
Iteration 54: objective = -1038.5058
Iteration 55: objective = -1038.5028
Iteration 56: objective = -1038.5006
Iteration 57: objective = -1038.4990
Iteration 58: objective = -1038.4978
Iteration 59: objective = -1038.4969
Iteration 60: objective = -1038.4962
Iteration 61: objective = -1038.4957
Iteration 62: objective = -1038.4954
Iteration 63: objective = -1038.4952
Iteration 64: objective = -1038.4950
Iteration 65: objective = -1038.4949
Iteration 66: objective = -1038.4948
Iteration 67: objective = -1038.4948
Iteration 68: objective = -1038.4948
Converged at iteration 69 with objective -1038.4948</code></pre>
<pre class="r"><code>plot(sim$X, col=alpha_colors[sim$z], cex=1,
     pch=19, main=&quot;EM Fitted Means with RW2 Prior (strong penalty)&quot;)
# Turn mu_list into matrix
mu_matrix &lt;- do.call(rbind, Q_prior_rw2_strong$params$mu)
# Draw arrows showing sequence
for (k in 1:(nrow(mu_matrix)-1)) {
  arrows(mu_matrix[k,1], mu_matrix[k,2],
         mu_matrix[k+1,1], mu_matrix[k+1,2],
         col=&quot;orange&quot;, lwd=4, length=0.1)
}</code></pre>
<p><img src="figure/explore_smoothEM.rmd/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-unnamed-chunk-15-1">
Past versions of unnamed-chunk-15-1.png
</button>
</p>
<div id="fig-unnamed-chunk-15-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/AgueroZZ/InferOrder/blob/028201f1d8f750fb9a4258a5722ce4c2fe116eb8/docs/figure/explore_smoothEM.rmd/unnamed-chunk-15-1.png" target="_blank">028201f</a>
</td>
<td>
Ziang Zhang
</td>
<td>
2025-07-08
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.7.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Chicago
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] Matrix_1.6-4      matrixStats_1.4.1 mclust_6.1.1      mvtnorm_1.3-1    
[5] MASS_7.3-60      

loaded via a namespace (and not attached):
 [1] jsonlite_2.0.0    compiler_4.3.1    promises_1.3.3    Rcpp_1.0.14      
 [5] stringr_1.5.1     git2r_0.33.0      later_1.4.2       jquerylib_0.1.4  
 [9] yaml_2.3.10       fastmap_1.2.0     lattice_0.22-6    R6_2.6.1         
[13] workflowr_1.7.1   knitr_1.50        tibble_3.2.1      rprojroot_2.0.4  
[17] bslib_0.9.0       pillar_1.10.2     rlang_1.1.6       cachem_1.1.0     
[21] stringi_1.8.7     httpuv_1.6.16     xfun_0.52         fs_1.6.6         
[25] sass_0.4.10       cli_3.6.5         magrittr_2.0.3    digest_0.6.37    
[29] grid_4.3.1        rstudioapi_0.16.0 lifecycle_1.0.4   vctrs_0.6.5      
[33] evaluate_1.0.3    glue_1.8.0        whisker_0.4.1     rmarkdown_2.28   
[37] tools_4.3.1       pkgconfig_2.0.3   htmltools_0.5.8.1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
